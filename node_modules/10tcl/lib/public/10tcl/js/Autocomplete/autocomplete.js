(function($) {
	$.fn.autocomplete = function(){
		
		function change(){
			var el           = $(this)
			  , fieldName    = el.attr('data-field')
			  , fieldsetName = el.attr('data-fieldset')
			  , searchURL    = el.attr('data-url')
			  , searchValue  = el.val()

			function afterGet( records, txt, jqXHR ){
				var place = $('#{1}-{2}-suggestions-place')
				  , template = $('#{1}-{2}-suggestions-template')

				records.each(function( record ){
					template.mu(record).stache(place)
				})
			}

			$.talkToServer( 'GET', searchURL + '/' + searchValue.encodeBase64(), afterGet )
		}

		$(this).change( change )
	}

})(jQuery)